<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>ULTRABLOCK: OMNIVERSE â€” ROUTES</title>
<style>
body{
    margin:0;
    background:black;
    display:flex;
    justify-content:center;
    align-items:center;
    height:100vh;
    font-family:monospace;
}
canvas{
    background:#0b0b0b;
    border:4px solid #ff0044;
    box-shadow:0 0 40px #ff0044;
}
</style>
</head>
<body>

<canvas id="game" width="400" height="600"></canvas>

<script>
/* ================= CORE ================= */
const c = document.getElementById("game");
const ctx = c.getContext("2d");

let keys = {};
let frame = 0;
let state = "platformer";
let flash = 0;

/* ROUTES */
let damageTaken = 0;
let rageTimer = 0;
let genocide = false;

/* ================= PLAYER ================= */
const player = {
    x:190,y:520,w:20,h:20,
    vx:0,vy:0,
    speed:5,
    gravity:0.6,
    jump:12,
    onGround:false,
    soul:"red",
    reset(x=190,y=520){
        this.x=x; this.y=y;
        this.vx=0; this.vy=0;
    },
    update(){
        if(keys.ArrowLeft) this.vx=-this.speed;
        else if(keys.ArrowRight) this.vx=this.speed;
        else this.vx=0;

        if(keys.ArrowUp && this.onGround && this.soul!=="blue"){
            this.vy=-this.jump;
            this.onGround=false;
        }

        this.vy += this.soul==="blue" ? this.gravity*1.6 : this.gravity;

        this.x+=this.vx;
        this.y+=this.vy;

        this.x=Math.max(0,Math.min(c.width-this.w,this.x));
        if(this.y>c.height) state="dead";
    },
    draw(){
        ctx.fillStyle=this.soul;
        ctx.shadowBlur=15;
        ctx.shadowColor=this.soul;
        ctx.fillRect(this.x,this.y,this.w,this.h);
        ctx.shadowBlur=0;
    }
};

/* ================= PLATFORMS ================= */
const platforms=[
    {x:40,y:470,w:120,h:10},
    {x:240,y:380,w:120,h:10},
    {x:60,y:290,w:120,h:10},
    {x:220,y:200,w:120,h:10}
];

function platformPhysics(){
    player.onGround=false;
    platforms.forEach(p=>{
        if(player.x+player.w>p.x &&
           player.x<p.x+p.w &&
           player.y+player.h>p.y &&
           player.y+player.h<p.y+12 &&
           player.vy>=0){
            player.y=p.y-player.h;
            player.vy=0;
            player.onGround=true;
        }
    });
}

/* ================= HAZARDS ================= */
let bullets=[];

function spawnBullet(x,y,vx,vy,size=8){
    bullets.push({x,y,vx,vy,size});
}

function hit(b){
    return (
        player.x < b.x + b.size &&
        player.x + player.w > b.x &&
        player.y < b.y + b.size &&
        player.y + player.h > b.y
    );
}

/* ================= UPDATE ================= */
function update(){
    if(state==="dead"||state==="win") return;

    player.update();
    if(state==="platformer") platformPhysics();

    /* PLATFORMER */
    if(state==="platformer"){
        if(player.y<120){
            state="boss";
            flash=20;
            player.reset(190,450);
        }
    }

    /* BOSS */
    if(state==="boss"){
        frame++;

        /* GENOCIDE TRIGGER */
        if(keys.ArrowDown && keys.ArrowLeft && keys.ArrowRight){
            rageTimer++;
            if(rageTimer>120){
                genocide=true;
                player.soul="white";
            }
        } else rageTimer=0;

        if(frame%20===0){
            let speed = genocide ? 7 : 4;
            spawnBullet(Math.random()*400,-10,
                (Math.random()-0.5)*2,speed);
        }

        bullets.forEach(b=>{
            b.x+=b.vx; b.y+=b.vy;
            if(hit(b)){
                damageTaken++;
                state="dead";
            }
        });

        bullets = bullets.filter(b=>b.y<650);

        if(frame>800){
            state="win";
        }
    }
}

/* ================= DRAW ================= */
function draw(){
    ctx.clearRect(0,0,400,600);

    platforms.forEach(p=>{
        ctx.fillStyle="#333";
        ctx.fillRect(p.x,p.y,p.w,p.h);
    });

    bullets.forEach(b=>{
        ctx.fillStyle="white";
        ctx.fillRect(b.x,b.y,b.size,b.size);
    });

    player.draw();

    if(flash>0){
        ctx.fillStyle="rgba(255,255,255,0.15)";
        ctx.fillRect(0,0,400,600);
        flash--;
    }

    if(state==="win"){
        ctx.fillStyle="rgba(0,0,0,0.8)";
        ctx.fillRect(0,0,400,600);
        ctx.fillStyle="white";
        ctx.textAlign="center";
        ctx.font="20px monospace";

        let ending =
            genocide ? "GENOCIDE ROUTE:\nYOU ERASED THE CORE." :
            damageTaken===0 ? "PACIFIST ROUTE:\nTHE WORLD REMEMBERS MERCY." :
            "NEUTRAL ROUTE:\nYOU SURVIVED, BUT AT A COST.";

        ending.split("\n").forEach((t,i)=>{
            ctx.fillText(t,200,260+i*30);
        });

        ctx.font="14px monospace";
        ctx.fillText("Refresh to Restart",200,350);
    }

    if(state==="dead"){
        ctx.fillStyle="rgba(0,0,0,0.8)";
        ctx.fillRect(0,0,400,600);
        ctx.fillStyle="white";
        ctx.textAlign="center";
        ctx.font="24px monospace";
        ctx.fillText("YOU FAILED",200,300);
    }
}

/* ================= LOOP ================= */
function loop(){
    update();
    draw();
    requestAnimationFrame(loop);
}

addEventListener("keydown",e=>keys[e.key]=true);
addEventListener("keyup",e=>keys[e.key]=false);

loop();
</script>
</body>
</html>